<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备拓扑关系图</title>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- 统一的样式 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .chart-container {
            width: 100%;
            height: 800px;
            margin-bottom: 30px;
        }
        .info-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        h2 {
            margin-bottom: 15px;
            color: #555;
        }
        ul {
            list-style-type: disc;
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .nav-links {
            margin-bottom: 20px;
            text-align: center;
        }
        .nav-links a {
            display: inline-block;
            margin: 0 10px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .nav-links a:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-links">
            <a href="/">事件分析</a>
            <a href="/topology">设备拓扑</a>
        </div>
        
        <h1>杨浦智慧消防设备拓扑关系图</h1>
        
        <div class="chart-container" id="topologyChart"></div>
        
        <div class="info-section">
            <h2>拓扑关系说明</h2>
            <ul>
                <li><strong>消防水泵房设备</strong>：水压监测、环境监测、液位监测设备连接在 RTU（远程终端单元）上，通过 RTU 供电和回传数据</li>
                <li><strong>楼层水压监测设备</strong>：单独通过 2G 无线网络回传到智慧消防服务器（公有云）</li>
                <li><strong>其他设备</strong>：包括烟雾报警器、温湿度传感器等，通过有线网络连接</li>
            </ul>
            
            <h2>设备连接方式</h2>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #5470c6;"></div>
                    <span>智慧消防服务器（公有云）</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #91cc75;"></div>
                    <span>RTU（远程终端单元）</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #fac858;"></div>
                    <span>消防水泵房设备</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ee6666;"></div>
                    <span>楼层水压监测设备</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #73c0de;"></div>
                    <span>其他设备（烟雾报警器等）</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3ba272;"></div>
                    <span>有线网络连接</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #fc8452;"></div>
                    <span>2G 无线网络连接</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 初始化拓扑图
        var myChart = echarts.init(document.getElementById('topologyChart'));
        
        // 设备拓扑数据
        var nodes = [
            // 核心节点
            { id: 'server', name: '智慧消防服务器（公有云）', symbolSize: 60, itemStyle: { color: '#5470c6' } },
            
            // RTU 节点
            { id: 'rtu1', name: 'RTU 1', symbolSize: 40, itemStyle: { color: '#91cc75' } },
            { id: 'rtu2', name: 'RTU 2', symbolSize: 40, itemStyle: { color: '#91cc75' } },
            { id: 'rtu3', name: 'RTU 3', symbolSize: 40, itemStyle: { color: '#91cc75' } },
            
            // 消防水泵房设备
            { id: 'pump_pressure1', name: '消防水泵房水压监测', symbolSize: 30, itemStyle: { color: '#fac858' } },
            { id: 'pump_env1', name: '消防水泵房环境监测', symbolSize: 30, itemStyle: { color: '#fac858' } },
            { id: 'pump_level1', name: '消防水泵房液位监测', symbolSize: 30, itemStyle: { color: '#fac858' } },
            { id: 'pump_pressure2', name: '消防水泵房水压监测', symbolSize: 30, itemStyle: { color: '#fac858' } },
            { id: 'pump_env2', name: '消防水泵房环境监测', symbolSize: 30, itemStyle: { color: '#fac858' } },
            { id: 'pump_level2', name: '消防水泵房液位监测', symbolSize: 30, itemStyle: { color: '#fac858' } },
            
            // 楼层水压监测设备
            { id: 'floor_pressure1', name: '楼层水压监测', symbolSize: 25, itemStyle: { color: '#ee6666' } },
            { id: 'floor_pressure2', name: '楼层水压监测', symbolSize: 25, itemStyle: { color: '#ee6666' } },
            { id: 'floor_pressure3', name: '楼层水压监测', symbolSize: 25, itemStyle: { color: '#ee6666' } },
            { id: 'floor_pressure4', name: '楼层水压监测', symbolSize: 25, itemStyle: { color: '#ee6666' } },
            { id: 'floor_pressure5', name: '楼层水压监测', symbolSize: 25, itemStyle: { color: '#ee6666' } },
            
            // 其他设备
            { id: 'smoke1', name: '烟雾报警器', symbolSize: 20, itemStyle: { color: '#73c0de' } },
            { id: 'smoke2', name: '烟雾报警器', symbolSize: 20, itemStyle: { color: '#73c0de' } },
            { id: 'smoke3', name: '烟雾报警器', symbolSize: 20, itemStyle: { color: '#73c0de' } },
            { id: 'smoke4', name: '烟雾报警器', symbolSize: 20, itemStyle: { color: '#73c0de' } },
            { id: 'temp1', name: '温湿度传感器', symbolSize: 20, itemStyle: { color: '#73c0de' } },
            { id: 'temp2', name: '温湿度传感器', symbolSize: 20, itemStyle: { color: '#73c0de' } }
        ];
        
        var links = [
            // RTU 连接到服务器
            { source: 'rtu1', target: 'server', lineStyle: { color: '#3ba272', width: 2, type: 'solid' } },
            { source: 'rtu2', target: 'server', lineStyle: { color: '#3ba272', width: 2, type: 'solid' } },
            { source: 'rtu3', target: 'server', lineStyle: { color: '#3ba272', width: 2, type: 'solid' } },
            
            // 消防水泵房设备连接到 RTU
            { source: 'pump_pressure1', target: 'rtu1', lineStyle: { color: '#3ba272', width: 1.5, type: 'solid' } },
            { source: 'pump_env1', target: 'rtu1', lineStyle: { color: '#3ba272', width: 1.5, type: 'solid' } },
            { source: 'pump_level1', target: 'rtu1', lineStyle: { color: '#3ba272', width: 1.5, type: 'solid' } },
            { source: 'pump_pressure2', target: 'rtu2', lineStyle: { color: '#3ba272', width: 1.5, type: 'solid' } },
            { source: 'pump_env2', target: 'rtu2', lineStyle: { color: '#3ba272', width: 1.5, type: 'solid' } },
            { source: 'pump_level2', target: 'rtu2', lineStyle: { color: '#3ba272', width: 1.5, type: 'solid' } },
            
            // 楼层水压监测设备连接到服务器（2G 无线）
            { source: 'floor_pressure1', target: 'server', lineStyle: { color: '#fc8452', width: 1.5, type: 'dashed' } },
            { source: 'floor_pressure2', target: 'server', lineStyle: { color: '#fc8452', width: 1.5, type: 'dashed' } },
            { source: 'floor_pressure3', target: 'server', lineStyle: { color: '#fc8452', width: 1.5, type: 'dashed' } },
            { source: 'floor_pressure4', target: 'server', lineStyle: { color: '#fc8452', width: 1.5, type: 'dashed' } },
            { source: 'floor_pressure5', target: 'server', lineStyle: { color: '#fc8452', width: 1.5, type: 'dashed' } },
            
            // 其他设备连接到服务器（有线）
            { source: 'smoke1', target: 'server', lineStyle: { color: '#3ba272', width: 1, type: 'solid' } },
            { source: 'smoke2', target: 'server', lineStyle: { color: '#3ba272', width: 1, type: 'solid' } },
            { source: 'smoke3', target: 'server', lineStyle: { color: '#3ba272', width: 1, type: 'solid' } },
            { source: 'smoke4', target: 'server', lineStyle: { color: '#3ba272', width: 1, type: 'solid' } },
            { source: 'temp1', target: 'server', lineStyle: { color: '#3ba272', width: 1, type: 'solid' } },
            { source: 'temp2', target: 'server', lineStyle: { color: '#3ba272', width: 1, type: 'solid' } }
        ];
        
        // 图表配置
        var option = {
            title: {
                text: '设备拓扑关系图',
                left: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: function(params) {
                    if (params.dataType === 'node') {
                        return params.name;
                    } else {
                        return params.source.name + ' → ' + params.target.name;
                    }
                }
            },
            animationDurationUpdate: 1500,
            animationEasingUpdate: 'quinticInOut',
            series: [
                {
                    type: 'graph',
                    layout: 'force',
                    data: nodes,
                    links: links,
                    roam: true,
                    label: {
                        show: true,
                        position: 'right',
                        formatter: '{b}'
                    },
                    labelLayout: {
                        hideOverlap: true
                    },
                    scaleLimit: {
                        min: 0.4,
                        max: 2
                    },
                    lineStyle: {
                        color: 'source',
                        curveness: 0.3
                    },
                    emphasis: {
                        focus: 'adjacency',
                        lineStyle: {
                            width: 4
                        }
                    },
                    force: {
                        repulsion: 1000,
                        edgeLength: [80, 120]
                    }
                }
            ]
        };
        
        // 设置图表配置
        myChart.setOption(option);
        
        // 响应式处理
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>
</body>
</html>